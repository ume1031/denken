<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電験三種 学習 V2.1</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --primary-color: #2563eb; --correct-color: #10b981; --wrong-color: #ef4444; }
        body { background-color: #f3f4f6; }
        .study-container { max-width: 700px; margin: 40px auto; }
        .card { border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .ox-btn { flex: 1; height: 150px; font-size: 5rem; border-radius: 20px; border: 3px solid #e5e7eb; background: white; }
        .explanation-box { margin-top: 25px; padding: 25px; border-radius: 15px; display: none; }
        .explanation-box.show { display: block; }
        .res-correct { background-color: #ecfdf5; border: 2px solid #10b981; color: #065f46; }
        .res-wrong { background-color: #fef2f2; border: 2px solid #ef4444; color: #991b1b; }
    </style>
</head>
<body>
<div class="study-container">
    <div class="card p-4">
        <div class="mb-3 d-flex justify-content-between">
            <span class="badge bg-primary">{{ card.category }}</span>
            <span>問題 {{ current }} / {{ total }}</span>
        </div>
        <div class="h4 mb-4">{{ display_q }}</div>

        {% if not is_answered %}
            <form action="/answer/{{ card.id }}" method="POST">
                {% if mode == 'fill' %}
                    {% for choice in choices %}
                        <button type="submit" name="user_answer" value="{{ choice }}" class="btn btn-outline-primary w-100 mb-2 p-3 text-start">{{ choice }}</button>
                    {% endfor %}
                {% else %}
                    <div class="d-flex gap-3">
                        <button type="submit" name="user_answer" value="正解" class="ox-btn text-success">○</button>
                        <button type="submit" name="user_answer" value="不正解" class="ox-btn text-danger">×</button>
                    </div>
                {% endif %}
            </form>
        {% else %}
            <div class="explanation-box show {% if is_correct %}res-correct{% else %}res-wrong{% endif %}">
                <h3 class="mb-3">{% if is_correct %}⭕ 正解！{% else %}❌ 不正解...{% endif %}</h3>
                <hr>
                <div class="fw-bold mb-1 text-secondary">【解説】</div>
                <p class="mb-0 fs-5">{{ card.note }}</p>
            </div>
            <div class="text-center mt-4">
                <a href="/study" class="btn btn-primary px-5 py-3 fw-bold">{% if current == total %}結果へ{% else %}次の問題へ{% endif %}</a>
            </div>
        {% endif %}
    </div>
</div>
</body>
</html>